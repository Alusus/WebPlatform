@merge module WebPlatform {
    class SafeTimeout {
        def timeoutHandler: ArchInt(0);

        handler this~terminate() {
            this.cancel();
        }

        handler this.set(duration: Word, cb: closure (Json)) {
            this.cancel();
            this.timeoutHandler = setTimeout(duration, cb);
        }

        handler this.cancel() {
            if this.timeoutHandler != 0 cancelTimeout(this.timeoutHandler);
        }
    }
}
