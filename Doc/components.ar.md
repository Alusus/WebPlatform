# WebPlatform

[[English]](components.en.md)

[[رجوع]](../readme.ar.md)

<div dir=rtl>

## المركّبات (Components)

المركبات تمكن المستخدم من إنشاء أجزاء من واجهة المستخدم قابلة لإعادة الاستخدام، ما يسهل على المستخدم
إنشاء واجهات مستخدم أكثر تعقيدًا. المركب يحتوي على مشهد يتكون من ودجة واحدة أو شجرة من الودجات
بالإضافة للتفاعلات اللازمة كمعالجة الأحداث وما شابه لهذا المشهد.

### كيفية إنشاء مركب

يمكن إنشاء مركب جديد عن طريق تعريف صنف خاص بهذا المركب مشتق من الصنف `مـركب` (`Component`)، مع تعريف
الباني (constructor) ليقوم بتهيئة المركب وإنشاء المشهد.

بشكل عام يمكن استعمال المساحة المستطيلة ووضع ما نريد من ودجات ضمنها، وتطبيق الأطرزة التي نريدها عليها.

بالإضافة لكل ذلك نقوم بتعريف طريقة تعيد سند إلى هذا المركب.

مثال على ذلك:

```
// نقوم بتعريف مركب يمثل ترويسة
صنف الـترويسة {
    @حقنة عرف مركب: مـركب؛

    عملية هذا~هيئ() {
        // نقوم بتعريف مساحة مستطيلة لتحوي الودجات الفرعية لهذا المركب
        هذا.المشهد = صـندوق({}).{
            // نقوم بتطبيق بعض الأطرزة
            الطراز.{
                العرض = مـسافة.مئوي(100)؛
                الطول = مـسافة.نقاط(85)؛
                الحشوة = مـسافة4.نقاط(4، 0، 0، 0)؛
                الخلفية = خـلفية(_لون_اصلي_)؛
                سمك_الإطار = مـسافة4.نقاط(1.5)؛
                طراز_الإطار = طـراز_إطار._مستمر_؛
                لون_الإطار = _لون_اصلي_؛
                ملء_السطر = مـلء_سطر._مسافة_بينية_؛
                الإظهار = إظـهار._مرن_؛
                النسق = نـسق._عمود_؛
            }؛
            // الودجات الفرعية
            أضف_فروع({
                // نضيف هنا الودجات الفرعية للمركب
            });
        }
    }

    // جعل عملية `الـترويسة()` ترجع سندا ذكيًا بدل إنشاء متغير مؤقت.
    عملية هذا_الصنف(): سـندنا[الـترويسة] {
        أرجع سـندنا[الـترويسة].أنشئ()؛
    }
}

```

<div dir=ltr>

```
class Header {
    @injection def component: Component;

    handler this~init() {
        // نقوم بتعريف مساحة مستطيلة لتحوي الودجات الفرعية لهذا المكون
        this.view = Box({}).{
            // نقوم بتطبيق بعض الأطرزة
            style.{
                width = Length.percent(100) - Length.pt(3);
                height = Length.pt(85);
                padding = Length4.pt(4, 0, 0, 0);
                background = Background(PRIMARY_COLOR);
                borderWidth = Length4.pt(1.5);
                borderStyle = BorderStyle.SOLID;
                borderColor = PRIMARY_COLOR;
                justify = Justify.SPACE_BETWEEN;
                display = Display.FLEX;
                layout = Layout.COLUMN;
            };
            // الودجات الفرعية
            addChildren({
                // نضيف هنا الودجات الفرعية للمركب
            });
        }
    }

    // جعل عملية `الـترويسة()` ترجع سندا ذكيًا بدل إنشاء متغير مؤقت.
    handler this_type(): SrdRef[Header] {
        return SrdRef[Header].construct();
    }
}
```

</div>

### مـبدال (Switcher)

يوفر هذا المركب مساحة يمكن عرض مشهد فيها وتبديله ديناميكيًا في أي وقت مع إمكانية تطبيق مؤثرات
انتقال لعملية التبديل.

```
صنف مـبدال {
    عرف حدد_الانتقال(اسم: نـص، انتقال: انـتقال_مبدال)؛
    عرف بدل_إلى(فرع: سـندنا[ودجـة])؛
    عرف بدل_إلى(فرع: سـندنا[ودجـة]، اسم_الانتقال: نـص)؛
    عرف أيجب_الاحتفاظ_بالفرع(فرع: سند[ودجـة])؛
}
```

<div dir=ltr>

```
class Switcher {
    handler this.setTransition(name: String, transition: SwitcherTransition);
    handler this.switchTo(child: SrdRef[Widget]);
    handler this.switchTo(child: SrdRef[Widget], transitionName: String);
    def shouldPreserveChild: closure (child: ref[Widget]): Bool;
}
```

</div>

#### حدد_الانتقال (setTransition)

```
عملية هذا.حدد_الانتقال(اسم_الانتقال: نـص، الانتقال: انـتقال_مبدال)؛
```

<div dir=ltr>

```
handler this.setTransition(name: String, transition: SwitcherTransition);
```

</div>

إضافة مؤثرات انتقال للاستخدام لاحقًا في دالة `بدل_إلى` (`switchTo`).

المعطيات:

* `اسم_الانتقال` (`name`) أي اسم يميز هذا الانتقال عن غيره.

* `الانتقال` (`transition`) تعريف الانتقال الذي نرغب في تطبيقه.


#### بدل_إلى (switchTo)

```
عملية هذا.بدل_إلى(فرع: سـندنا[ودجـة])؛
عملية هذا.بدل_إلى(فرع: سـندنا[ودجـة]، اسم_الانتقال: نـص)؛
```

<div dir=ltr>

```
handler this.switchTo(child: SrdRef[Widget]);
handler this.switchTo(child: SrdRef[Widget], transitionName: String);
```

</div>

تبديل المشهد الحالي إلى مشهد جديد. الصيغة الأولى تبدل المشهد دون أي مؤثرات انتقال، بينما بدل
الصيغة الثانية المشهد مع مؤثرات الانتقال المحددة بالاسم المعطى. الاسم يجب أن يطابق أحد المؤثرات
المضافة باستخدام دالة `حدد_الانتقال` (`setTransition`).

#### أيجب_الاحتفاظ_بالفرع (shouldPreserveChild)

```
عرف أيجب_الاحتفاظ_بالفرع: مغلفة (الفرع: سند[ودجـة]): ثـنائي؛
```

<div dir=ltr>

```
def shouldPreserveChild: closure (child: ref[Widget]): Bool;
```

</div>

مغلفة للاستدعاء العكسي، تُستدعى عند خروج مشهد من الصورة (أي بعد التبديل إلى مشهد آخر) لتحديد ما إن
كنا نرغب بحذف المشهد القديم أم إبقاؤه مخفيا للاستخدام لاحقًا. في بعض الحالات قد ترغب بإبقاء المشهد
وعدم حذفه في حال رجع المستخدم إليه لاحقًا كي لا يخسر المستخدم أي مدخلات أحدثها في المشهد. إن أرجعت
هذه المغلفة قيمة 1 فإن المشهد سيبقى مخفيًا في الذاكرة ويمكن العودة إليه لاحقًا باستخدام دالة
`بدل_إلى` (`switchTo`) وإعطاؤها نفس الودجة، أما في حالة أرجعت الدالة 0 أو لم يحدد المستخدم هذه
المغلفة من الأساس فإن المشهد سيُحذف من المتصفح وسيُعاد إنشاؤه عند استدعاء `بدل_إلى` مجددًا. في هذه
الحالة حتى لو احتفظت بالودجة في الذاكرة فإن عنصر DOM المقابل لهذه الودجة سيحذف من المتصفح
وبالتالي يخسر المستخدم ما أحدثه على ذلك العنصر في المتصفح.


### انـتقال_مبدال (SwitcherTransition)

```
صنف انـتقال_مبدال {
    عرف طراز_المشهد_الحالي: طـراز؛
    عرف طراز_المشهد_التالي: طـراز؛
    عرف المدة_الكلية: صـحيح؛
}
```

<div dir=ltr>

```
class SwitcherTransition {
    def currentViewStyle: Style;
    def incomingViewStyle: Style;
    def totalDuration: Int;
}
```

</div>

يحمل هذا الصنف خصائص الانتقال المستخدم في مبدال. يعتمد تعريف الانتقال على الطرز وما تملكه من خصائص
للتحريك والمؤثرات.

`طراز_المشهد_الحالي` (`currentViewStyle`) طراز المشهد الحالي الذي سيخرج من مساحة العرض. هذا الطراز
يجب أن يحمل تعريف المؤثرات الحركية للمشهد، كأن يحدد مؤثرات انزلاق المشهد جانبيا إلى خارج مساحة العرض.

`طراز_المشهد_التالي` (`incomingViewStyle`) طراز المشهد الجديد الذي سيدخل مساحة العرض. هذا الطراز
يجب أن يحمل تعريف المؤثرات الحركية للمشهد، كأن يحدد مؤثرات انزلاق المشهد جانبيًا من خارج مساحة العرض
إلى وسطها.

`المدة_الكلية` (`totalDuration`) المدة الكاملة للانتقال.

راجع شروح الطرز لمزيد من المعلومات حول تعريف المؤثرات الحركية.


### مـبدال_توجيه (RoutingSwitcher)

يمثل هذا الصتف مبدال يقوم بالتبديل بين المشاهد بناءًا على المسارات.

#### عند_المسار_المجهول (onUnknownRoute)

```
عرف عند_المسار_المجهول: مغلف(سند[مـبدال_توجيه]، حـمولة_مسار)؛
```

<div dir=ltr>

```
def onUnknownRoute: closure(ref[RoutingSwitcher], RoutePayload);
```

</div>

مغلفة للاستدعاء العكسي تُستدعى عندما يكون المسار غير معروف بالنسبة للمبدال.

#### تسلسل_المسار_الحالي (currentRouteIndex)

عدد صحيح يمثل تسلسل المسار الحالي ضمن المسارات المعرفة في هذا المبدال.

#### مسار (route)

```
عرف مسار(مسار: نـص): سند[مـنادى_مسار]؛
عرف مسار(مسار: مـؤشر[مـحرف]): سند[مـنادى_مسار]؛
عرف مـنادى_مسار: لقب مغلفة(حـمولة_مسار): سـندنا[ودجـة]؛
```

<div dir=ltr>

```
handler this.route(r: String): ref[RouteCallback];
handler this.route(r: CharsPtr): ref[RouteCallback];
def RouteCallback: alias closure(RoutePayload): SrdRef[Widget];
```

</div>

تحديد الدالة العكسية التي ستُستدعى عند تغير المسار إلى المسار المُعطى في هذه الدالة. دالة `مسار`
تُرجع سندًا للمغلفة كي يتمكن المستخدم من تحديد قيمة للمغلفة. يجب على المغلفة أن ترجع سندا إلى
الودجة التي ستُعرض في المبدال. معطى دالة `مسار` تعبير نمطي (regular expression).

#### حدد_الانتقال (setTransition)

```
عرف حدد_الانتقال(أمامي: انـتقال_مبدال، خلفي: انـتقال_مبدال)؛
```

<div dir=ltr>

```
handler this.setTransition(forward: SwitcherTransition, backward: SwitcherTransition);
```

</div>

تحديد الانتقالين المطلوبين في حالتي الذهاب إلى الرابط السابق أو التالي.

#### استنتج_تسلسل_المسار_الحالي (determineCurrentRouteIndex)

```
عرف استنتج_تسلسل_المسار_الحالي(): صـحيح؛
عرف استنتج_تسلسل_المسار_الحالي(حمولة_مسار: سند[حـمولة_مسار]): صـحيح؛
```

<div dir=ltr>

```
handler this.determineCurrentRouteIndex(): Int;
handler this.determineCurrentRouteIndex(rp: ref[RoutePayload]): Int;
```

</div>

تستنتج تسلسل المسار الحالي نسبة للمسارات المعرفة في هذا المبدال. الصيغة الثانية تسمح بإرجاع بيانات
المسار الحالي بالإضافة لتسلسله.


### مـكداس (Stack)

يسمح هذا الصنف للمستخدم بتكديس عدة مشاهد فوق بعضها البعض، مع إمكانية إضافة تحريك عند إضافة مشهد وعند
إزالته.

#### حدد_الانتقال (setTransition)

```
عرف حدد_الانتقال(اسم: نـص، انتقال: انـتقال_مـكداس)؛
```

<div dir=ltr>

```
handler this.setTransition(name: String, transition: StackTransition);
```

</div>

إضافة مؤثرات انتقال للاستخدام لاحقًا في دالة `أضف` (`push`).

المعطيات:

* `اسم_الانتقال` (`name`) أي اسم يميز هذا الانتقال عن غيره.

* `الانتقال` (`transition`) تعريف الانتقال الذي نرغب في تطبيقه.

#### أضف (push)

```
عرف أضف(فرع: سـندنا[ودجـة])؛
عرف أضف(فرع: سـندنا[ودجـة]، اسم_الانتقال: نـص)؛
```

<div dir=ltr>

```
handler this.push(child: SrdRef[Widget]);
handler this.push(child: SrdRef[Widget], transitionName: String);
```

</div>

تستمل لإضافة مشهد إلى المكداس. المشهد المضاف يظهر أمام المشاهد الحالية. الصيغة الثانية من الدالة
تسمح بتحديد الانتقال (المؤثرات الحركية) المطلوبة. بدون تحديد الانتقال ستتم الإضافة بشكل لحظي دون أي
مؤثرات. اسم الانتقال يجب أن يطابق اسم أحد الانتقالات المضافة بدالة `حدد_الانتقال`.


#### أزل (pop)

```
عرف أزل()؛
عرف أزل(اسم_الانتقال: نـص)؛
```

<div dir=ltr>

```
handler this.pop();
handler this.pop(transitionName: String);
```

</div>

تستعمل لإزالة مشهد من قمة المكداس. الصيغة الأولى تزيل المشهد لحظيا دون مؤثرات بينما تسمح الصيغة
الثانية بتحديد الانتقال المراد تطبيقه. اسم الانتقال يجب أن يطابق اسم أحد الانتقالات المضافة بدالة
`حدد_الانتقال`.


### مـكداس_توجيه (RoutingStack)

مكداس يعتمد على المسار الحالي لتكديس المشاهد وإزالتها تلقائيًا.

#### عند_المسار_المجهول (onUnknownRoute)

```
عرف عند_المسار_المجهول: مغلف(سند[مـبدال_مـكداس]، حـمولة_مسار)؛
```

<div dir=ltr>

```
def onUnknownRoute: closure(ref[RoutingStack], RoutePayload);
```

</div>

مغلفة للاستدعاء العكسي تُستدعى عندما يكون المسار غير معروف بالنسبة للمكداس.

#### مسار (route)

```
عرف مسار(مسار: نـص): سند[مـنادى_مسار]؛
عرف مسار(مسار: مـؤشر[مـحرف]): سند[مـنادى_مسار]؛
عرف مـنادى_مسار: لقب مغلفة(حـمولة_مسار): سـندنا[ودجـة]؛
```

<div dir=ltr>

```
handler this.route(r: String): ref[RouteCallback];
handler this.route(r: CharsPtr): ref[RouteCallback];
def RouteCallback: alias closure(RoutePayload): SrdRef[Widget];
```

</div>

تحديد الدالة العكسية التي ستُستدعى عند تغير المسار إلى المسار المُعطى في هذه الدالة. دالة `مسار`
تُرجع سندًا للمغلفة كي يتمكن المستخدم من تحديد قيمة للمغلفة. يجب على المغلفة أن ترجع سندا إلى
الودجة التي ستُعرض في المكداس. معطى دالة `مسار` تعبير نمطي (regular expression).

بعكس `مـبدال_توجيه`، يستمر `مـكداس_توجيه` بمطابقة كافة المسارات بدءًا من أول مسار حتى يصل مسارًا
غير مطابق، ومع كل مطابقة يقوم بإضافة المشهد. وعندما يصل مسارا غير مطابق يُزيل المشهد المقابل لذلك
المسار تلقائيًا. على سبيل المثال، إن حددت المسارات التالية:
ا: /أول/
ب: /أول/ثاني/
ت: /أول/ثاني/ثالث/
ث: /أول/ثاني/ثالث/رابع/
ثم انتقل المستخدم مباشرة إلى المسار `/أول/ثاني/ثالث/` فإن المكداس سيضيف المسارات ا و ب و ت وليس
فقط ت. وإذا انتقل المستخدم من مسار `/أول/ثاني/` إلى `/أول/ثاني/ثالث/` فإن المكداس سيضيف فقط ت. أما
إذا انتقل من `/أول/ثاني/ثالث/` إلى `/أول/` فإن المكداس سيزيل المشهدين ت و ب، وهكذا.

#### حدد_الانتقال (setTransition)

```
عرف حدد_الانتقال(إضافة: انـتقال_مكداس، إزالة: انـتقال_مكداس)؛
```

<div dir=ltr>

```
handler this.setTransition(pushing: StackTransition, popping: StackTransition);
```

</div>

تستعمل هذه الطريقة لتحديد الانتقال لحالتي الإضافة والإزالة.


### إسـفيجي_ضمنية (EmbeddedSvg)

تستخدم لتضمين صورة SVG ضمن البرنامج التنفيذي بدل تحميلها بعد بدء البرنامج. هذا الصنف قالب يستلم
معطى واحد وهو المسار إلى ملف SVG.

```
صـنف إسـفيجي_ضمنية [مسار_إسفيجي: نص]
```

<div dir=ltr>

```
class EmbeddedSvg [filename: string]
```

</div>

المثال التالي يوضح طريقة الاستخدام:

```
    صـندوق().{
        أضف_فروع({ إسـفيجي_ضمنية["المارد/أيقونة.svg"]() })؛
    }
```

<div dir=ltr>

```
Box().{
    addChildren({ EmbeddedSvg["resources/icon.svg"] });
}
```

</div>

</div>

