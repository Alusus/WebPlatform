# WebPlatform

[[English]](saferequest.en.md)

[[رجوع]](../readme.ar.md)

### نـداء_آمن (SafeRequest)

<div dir=rtl>

```
صنف نـداء_آمن {
    عملية هذا.أرسل(
        طريقة: مؤشر[مـحرف]، عنوان: مؤشر[مـحرف]، ترويسات: مؤشر[مـحرف]، متن: مؤشر[مـحرف]،
        الصلاحية_بالميلي_ثانية: صـحيح، منادى: مغلفة(جـيسون)
    ): ثـنائي؛
    عملية هذا.ألغ()؛
    عملية هذا.قيد_الإرسال: ثـنائي؛
}
```

</div>

```
class SafeRequest {
    handler this.send (
        method: ptr[Char], uri: ptr[Char], headers: ptr[Char], body: ptr[Char], timeoutInMs: Int, cb: closure (Json)
    ): Bool;
    handler this.cancel();
    handler this.inProgress: Bool;
}
```

يستخدم هذا الصنف لإرسال نداء HTTP بشكل آمن في حال أرسل النداء من داخل دالة أو صنف معرض للإزالة
من الذاكرة قبل انتهاء النداء. يحتوي هذا الصنف على وظيفة `أرسل` (`send`) لإرسال النداء وهي مشابهة
في تعريفها ومعطياتها للدالة العمومية `أرسل_نداء` لكنها تضمن أمرين:
* يتم إرسال نداء واحد فقط في الوقت الواحد، فإن استدعيت `أرسل` مجددا قبل انتهاء النداء السابق
  ستمتنع الدالة عن إرسال نداء جديد وسترجع قيمة 0 بدلًا من ذلك.
* عند إزالة الصنف من الذاكرة يُلغي النداء الحالي إن وجد لضمان عدم الولوج إلى عناصر إزيلت من
  من الذاكرة قبل اكتمال النداء.
ترجع دالة `أرسل` قيمة 1 إن تم الإرسال، بغض النظر عن نتيجة الإرسال نفسه.

الوظيفة `ألغ` (`cancel`) تُلغي النداء الحالي إن وجد فإن لم يوجد ترجع دون فعل شيء. أما الخصلة
`قيد_الإرسال` (`inProgress`) فترجع 1 إن وجد وقتها نداءٌ لم يكتمل بعد.

