# WebPlatform

[[English]](global_funcs.en.md)

[[رجوع]](../readme.ar.md)

## الدوال  والمتغيرات العمومية

### مسار_منصة_ويب (webPlatformPath)

<div dir=rtl>

```
عرف مسار_منصة_ويب: نـص؛
```

</div>

```
def webPlatformPath: String;
```
مسار ملفات مـنصة_ويب نفسها في نظام الملفات.


### مسار_الموارد_الرئيسية (mainAssetsPath)

<div dir=rtl>

```
عرف مسار_الموارد_الرئيسية: نـص؛
```

</div>

```
def mainAssetsPath: String;
```

المسار الذي نضع فيه الموارد الرئيسية التابعة لمنصة الويب والمطلوبة في كل تطبيق.


### مسار_ويب_أسمبلي (wasmPath)

<div dir=rtl>

```
عرف مسار_ويب_أسمبلي: نـص؛
```

</div>

```
def wasmPath: String;
```

المسار الذي توضع فيه ملفات ويب أسمبلي بعد بنائها.


### هات_اعتماديات_البناء (getBuildDependencies)

<div dir=rtl>

```
عرف هات_اعتماديات_البناء(): مـصفوفة[نـص]؛
```

</div>

```
func getBuildDependencies(): Array[String];
```
دالة تعيد مصفوفة من المكتبات و الحزم الضرورية لبناء نسخة تنفيذية من التطبيق.


### أنشئ_عنصر (createElement)

<div dir=rtl>

```
عرف أنشئ_عنصر(نمط: مؤشر[مـحرف]، اسم: مؤشر[مـحرف]، أب: مؤشر[مـحرف])؛
```

</div>

```
function createElement (type: ptr[Char], name: ptr[Char], parent: ptr[Char]);
```

تنشئ عنصرًا في شجرة DOM المتصفح. تستخدم هذه الدالة من قبل الودجات لعرضها في المتصفح.

المعطيات:

`نمط` (`type`) نمط العنصر المراد إنشاءه.

`اسم` (`name`) اسم العنصر المراد إنشاءه.

`أب` (`parent`) العنصر الذي نريد إضافة العنصر الحالي ضمنه.


### حدد_ميزة_عنصر (setElementAttribute)

<div dir=rtl>

```
عرف حدد_ميزة_عنصر(اسم: مؤشر[مـحرف]، خاصية: مؤشر[مـحرف]، قيمة: مؤشر[مـحرف])؛
```

</div>

```
function setElementAttribute (name: ptr[Char], prop: ptr[Char], value: ptr[Char])
```

تحدد قيمة ميزة لعنصر من عناصر DOM. تستخدم من قبل الودجات للتحكم بخصائص العناصر في المتصفح.

المعطيات:

`اسم` (`name`) اسم العنصر.

`خاصية` (`prop`) اسم الخاصية المراد تحديد قيمتها.

`قيمة` (`value`) قيمة الميزة التي نريد تحديدها.


### حدد_متن_طراز (setStyleRule)

<div dir=rtl>

```
عرف حدد_متن_طراز(اسم: مؤشر[مـحرف]، محدد: مؤشر[مـحرف]، الأطرزة: مؤشر[مـحرف])؛
```

</div>

```
function setStyleRule (name: ptr[Char], selector: ptr[Char], css: ptr[Char])
```

دالة لتحديد متن طراز في المتصفح. تستخدم من قبل أصناف الطرز لنقل خيارات المستخدم إلى المتصفح.

المعطيات:

`اسم` (`name`) اسم المتن الذي نريد إضافته.

`محدد` (`selector`) المحدد المسؤول عن تحديد العناصر التي سيتم تطبيق الطراز عليها.

`الأطرزة` (`css`) الأطرزة الخاصة بالمتن.


### نفذ_حلقة_معالجة_الأحداث (runEventLoop)

<div dir=rtl>

```
عرف نفذ_حلقة_معالجة_الأحداث؛
```

</div>

```
function runEventLoop;
```

تنفيذ حلقة معالجة الأحداث بشكل لا نهائي. يحتاج المستخدم لمعالجة الأحداث بشكل دوري وإلا سيتوقف
التطبيق عن الاستجابة للأحداث التي تحدث في المتصفح.


### عالج_الأحداث (dispatchEvents)

<div dir=rtl>

```
عرف عالج_الأحداث؛
```

</div>

```
function dispatchEvents;
```

تعالج الأحداث وتوجهها إلى مستقبلاتها. تعالج هذه الدالة كل الأحداث المنتظِرة وترجع بعد ذلك دون
انتظار المزيد.


### انتظر_حدثا (waitForEvent)

<div dir=rtl>

```
عرف انتظر_حدثا؛
```

</div>

```
function waitForEvent;
```

توقف تنفيذ البرنامج لحين ورود حدث إلى طابور الأحداث.


### شغل_الخادم (runServer)

<div dir=rtl>

```
عرف شغل_الخادم(عدد_الخيارات: صـحيح، الخيارات: ...مؤشر[مـحرف])؛
```

</div>

```
func runServer(optsCount: Int, opts: ...CharsPtr);
```

دالة تستعمل لتشغيل خادم الويب. تشغل هذه الدالة الخادم وتنتظر المستخدم أن يكبس زرًا على لوحة المفاتيح
ثم تغلق الخادم وترجع.

المعطيات:

`عدد_الخيارات` (`optsCount`) عدد الخيارات المراد ضبطها للخادم.

`الخيارات` (`opts`) الخيارات الخاصة بالخادم التي نريد ضبطها.


### ابدأ_الخادم (startServer)

<div dir=rtl>

```
عرف ابدأ_الخادم(عدد_الخيارات: صـحيح، الخيارات: ...مؤشر[مـحرف]): مؤشر[بننف.سـياق]؛
```

</div>

```
func startServer(optsCount: Int, opts: ...CharsPtr): ptr[Http.Context];
```

دالة تستعمل لبدء عمل الخادم. تشبه هذه الدالة عمل `شغل_الخادم` (`runServer`) لكنها لا تنتظر وإنما
تشغل الخادم وترجع تاركة الخادم مشتغلًا.

المعطيات:

`عدد_الخيارات` (`optsCount`) عدد الخيارات المراد ضبطها للخادم.

`الخيارات` (`opts`) الخيارات الخاصة بالخادم التي نريد ضبطها.

القيمة المرجعة:

`مؤشر[بننف.سـياق]` (`ptr[Http.Context]`) مؤشر إلى السياق الذي يمكن استعماله للتواصل مع الخادم.


### أضف_وحدة_منافذ (registerEndpointsModule)

<div dir=rtl>

```
ماكرو أضف_وحدة_منافذ[اسم_الوحدة]
```

</div>

```
macro registerEndpointsModule[m]
```

يستخدم هذا الماكرو لإضافة وحدة تحتوي دالات منافذ (مرئية أو بيانية). يمكن استدعاء هذا الماكرو عدة مرات
لإضافة وحدات متعددة قبل تشغيل الخادم، أي قبل استدعاء `ابدأ_الخادم`.


### ابدأ_المؤقت_المتكرر (startTimer)

<div dir=rtl>

```
عرف ابدأ_المؤقت_المتكرر(مدة: طـبيعي، م: مغلف(جـيسون)): صـحيح_متكيف؛
```

</div>

```
function startTimer (duration: Word, cb: closure (Json)): ArchInt;
```

تبدأ مؤقِتًا يستدعي المغلفة المعطاة بشكل متكرر.

المعطيات:

`مدة` (`duration`) المدة بين استدعاء و آخر للمغلف.

`م` (`cb`) المغلف المراد استدعاءه بشكل متكرر.

القيمة المرجعة:

`صـحيح_متكيف؛` (`ArchInt`) المعرف الخاص بهذا المؤقت.


### أوقف_المؤقت_المتكرر (stopTimer)

<div dir=rtl>

```
عرف أوقف_المؤقت_المتكرر(معرف: صـحيح_متكيف)؛
```

</div>

```
function stopTimer (id: ArchInt);
```

دالة تستعمل لإيقاف مؤقت متكرر.

المعطيات:

`معرف` (`id`) معرف فريد للمؤقت الذي نريد إيقافه.


### ابدأ_المؤقت (setTimeout)

<div dir=rtl>

```
عرف ابدأ_المؤقت(مدة: طـبيعي، م: مغلف(جـيسون)): صـحيح_متكيف؛
```

</div>

```
function setTimeout (duration: Word, cb: closure (Json)): ArchInt;
```

دالة تستعمل لبدء المؤقت الذي يستعمل لتنفيذ مغلف بعد فترة زمنية معينة ولمرة واحدة.

المعطيات:

`مدة` (`duration`) المدة حتى يتم استدعاء المغلف.

`م` (`cb`) المغلف المراد استدعاءه.

القيمة المرجعة:

`صـحيح_متكيف؛` (`ArchInt`) المعرف الخاص بهذا المؤقت.


### ألغ_المؤقت (cancelTimeout)

<div dir=rtl>

```
عرف ألغ_المؤقت(معرف: صـحيح_متكيف)؛
```

</div>

```
function cancelTimeout (id: ArchInt);
```

دالة تستعمل لإيقاف مؤقت قبل تنفيذه.

المعطيات:

`معرف` (`id`) معرف فريد للمؤقت الذي نريد إيقافه.


### أرسل_نداء (sendRequest)

<div dir=rtl>

```
عرف أرسل_نداء(
    طريقة: مؤشر[مـحرف]، عنوان: مؤشر[مـحرف]، ترويسات: مؤشر[مـحرف]، متن: مؤشر[مـحرف]،
    الصلاحية_بالميلي_ثانية: صـحيح، منادى: مغلفة(جـيسون)
)؛
عرف أرسل_نداء(
    طريقة: مؤشر[مـحرف]، عنوان: مؤشر[مـحرف]، ترويسات: مؤشر[مـحرف]، متن: مؤشر[مـحرف]،
    الصلاحية_بالميلي_ثانية: صـحيح
): سـندنا[مـؤجلة[جـيسون]]؛
```

</div>

```
function sendRequest (
    method: ptr[Char], uri: ptr[Char], headers: ptr[Char], body: ptr[Char], timeoutInMs: Int,
    cb: closure (Json)
);
function sendRequest (
    method: ptr[Char], uri: ptr[Char], headers: ptr[Char], body: ptr[Char], timeoutInMs: Int
): SrdRef[Promise[Json]];
```

دالة لإرسال نداء إلى الخادم. الصيغة الأولى من الدالة تستدعي `منادى` (`cb`) عند اكتمال النداء بينما
ترجع الصيغة الثانية مؤجلة بنتيجة النداء. البيانات المرجعة من النداء صيغتها جيسون وبهذه الهيكلة:

```
{
    "eventData": {
        "status": <number>,
        "headers": { "key1": "val1", "key2": "val2", ... },
        "body": <string>
    }
}
```


### حمل_خط (loadFont)

<div dir=rtl>

```
عرف حمل_خط(اسم_الخط: مؤشر[مـحرف]، مسار: مؤشر[مـحرف]): سـندنا[مـؤجلة[صـحيح]]؛
```

</div>

```
function loadFont (fontName: ptr[Char], url: ptr[Char]): SrdRef[Promise[Int]];
```

دالة لتحميل خط معين.

المعطيات:

`اسم_الخط` (`fontName`) اسم اعتباطي لتسمية الخط به. يستخدم هذا الاسم لاحقًا في واجهة المستخدم
للإشارة إلى هذا الخط.

`مسار` (`url`) المسار الذي يتواجد عليه ملف الخط.


### حمل_بريمج_جافاسكريبت (loadJsScript)

<div dir=rtl>

```
عرف حمل_بريمج_جافاسكريبت(مسار: مؤشر[مـحرف]): سـندنا[مـؤجلة[صـحيح]]؛
```

</div>

```
function loadJsScript (url: ptr[Char]): SrdRef[Promise[Int]];
```

دالة تستعمل لتحميل بريمج جافاسكربت. تفيد هذه الدالة في الربط مع مكتبات جافاسكريبت جاهزة.

المعطيات:

`مسار` (`url`) مسار البريمج.


### استدع_دالة_جافاسكريبت (callCustomJsFn)

<div dir=rtl>

```
عرف استدع_دالة_جافاسكريبت(اسم_الدالة: مؤشر[مـحرف]، معطى: مؤشر[مـحرف]): مؤشر[مـحرف]؛
```

</div>

```
function callCustomJsFn (fnName: ptr[Char], arg: ptr[Char]): ptr[Char];
```

دالة لاستدعاء دالة جافاسكربت. تفيد في استدعاء دالات جافاسكربت لمكتبات خارجية.

المعطيات:

`اسم_الدالة` (`fnName`) اسم الدالة المراد استدعاءها.

`معطى` (`arg`) المعطيات التي نرغب بتمريرها للدالة.

القيمة المرجعة:

`مؤشر[مـحرف]` (`ptr[Char]`) نتيجة الاستدعاء.


### استدع_دالة_جافاسكريبت_لامتزامنة (callCustomAsyncJsFn)

<div dir=rtl>

```
عرف استدع_دالة_جافاسكريبت_لامتزامنة(اسم_الدالة: مؤشر[مـحرف]، معطى: مؤشر[مـحرف]): سـندنا[مـؤجلة[نـص]]؛
```

</div>

```
function callCustomAsyncJsFn (fnName: ptr[Char], arg: ptr[Char]): SrdRef[Promise[String]];
```

دالة لاستدعاء دالة جافاسكربت لامتزامنة. تفيد في استدعاء دالات لمكتبات خارجية.

المعطيات:

`اسم_الدالة` (`fnName`) اسم الدالة المراد استدعاءها.

`معطى` (`arg`) المعطيات التي نرغب بتمريرها للدالة.

القيمة المرجعة:

`مؤشر[مـحرف]` (`ptr[Char]`) نتيجة الاستدعاء على شكل مـؤجلة و ذلك ﻷن الاستدعاء غير متزامن.


### التمس_يقظة_الشاشة (requestWakeLock)

<div dir=rtl>

```
عرف التمس_يقظة_الشاشة(): سـندنا[مـؤجلة[ثـنائي]]؛
```

</div>

```
function requestWakeLock (): SrdRef[Promise[Bool]];
```

تلتمس إلغاء قفل الشاشة أثناء تشغيل التطبيق. تُرجع 1 إن نجحت العملية، و 0 إن فشلت العملية
أو كان المتصفح لا يدعم هذه الخاصية.


### ألغ_يقظة_الشاشة (exitWakeLock)

<div dir=rtl>

```
عرف ألغ_يقظة_الشاشة(): سـندنا[مـؤجلة[ثـنائي]]؛
```

</div>

```
function exitWakeLock (): SrdRef[Promise[Bool]];
```

تُلغي يقظة الشاشة وتعيد تمكين قفل الشاشة إن وجد. تُرجع 1 إن نجحت العملية، و 0 إن فشلت العملية
أو كان المتصفح لا يدعم هذه الخاصية.


### أضف_مسار_موارد (addAssetRoute)

<div dir=rtl>

```
عرف أضف_مسار_موارد(عنوان_الخادم: نـص، مسار_المجلد: نـص)؛
```

</div>

```
func addAssetRoute (uri: String, path: String);
```

دالة تستخدم في جهة الخادم لإضافة مسار جديد للموارد لغرض الاستخدام في واجهة المستخدم.

المعطيات:

`عنوان_الخادم` (`uri`) مسار المجلد ضمن الخادم.

`مسار_المجلد` (`path`) مسار المجلد في نظام الملفات.


### هات_لغات_المستخدم (getUserLanguages)

<div dir=rtl>

```
عرف هات_لغات_المستخدم(): مـصفوفة[نـص]؛
```

</div>

```
func getUserLanguages(): Array[String];
```

دالة تعيد تفضيلات اللغات الخاصة بالمستخدم والمحددة في متصفحه.


### هات_اللغة_المفضلة (getPreferredLanguage)

<div dir=rtl>

```
عرف هات_اللغة_المفضلة(اللغات_المتوفرة: مـصفوفة[نـص]): نـص؛
```

</div>

```
func getPreferredLanguage(availableLangues: Array[String]): String;
```

دالة تعيد اللغة المفضلة للمستخدم من مجموعة لغات. ترجع هذه الدالة أول لغة من لغات المستخدم المفضلة
تطابق إحدى اللغات المعطاة، فإن لم تجد أرجعت أول لغة من اللغات المعطاة.

المعطيات:

`اللغات_المتوفرة` (`availableLangues`) اللغات المتوفرة للاختيار بينها.


### هل_يفضل_نمط_الألوان_الداكن (isDarkColorSchemePreferred)

<div dir=rtl>

```
عرف هل_يفضل_نمط_الألوان_الداكن(): ثـنائي؛
```

</div>

```
function isDarkColorSchemePreferred (): Bool;
```

دالة تعيد فيما إذا كان النمط المفضل عند المستخدم هو الألوان الداكنة.


### هات_الختم_الزمني (getTimestamp)

<div dir=rtl>

```
عرف هات_الختم_الزمني(): صـحيح[64]؛
```

</div>

```
function getTimestamp (): Int[64];
```

دالة تعيد الختم الزمني الحالي بالميلي ثانية.


### هات_التاريخ (getDate)

<div dir=rtl>

```
دالة هات_التاريخ(توع: مـؤشر_محارف، الختم_الزمني: صـحيح[64]): مـؤشر_محارف؛
```

</div>

```
function getDate(type: CharsPtr, timestamp: Int[64]): CharsPtr;
```

ترجع التاريخ بصيغة نصية.

`نوع` (`type`): تحدد الصيغة النصية المطلوبة. يمكن أن تكون `iso` أو `locale` أو سلسلة نصية فارغة.

`الختم_الزمني` (`timestamp`): الختم الزمني الذي نرغب بالحصول على التاريخ له. إن كانت هذه القيمة
-1 فسترجع التاريخ الحالي.


### ألغ_احتكار_المؤشر (exitPointerLock)

<div dir=rtl>

```
عرف ألغ_احتكار_المؤشر()؛
```

</div>

```
function exitPointerLock();
```
دالة تلغي احتكار المؤشر.


### ألغ_ملء_الشاشة (exitFullScreen)

<div dir=rtl>

```
عرف ألغ_ملء_الشاشة()؛
```

</div>

```
function exitFullScreen();
```

دالة للخروج من وضع ملء الشاشة.


### هات_عدد_المقابض (getGamepadsCount)

<div dir=rtl>

```
عرف هات_عدد_المقابض(): صـحيح؛
```

</div>

```
function getGamepadsCount (): Int;
```

تعيد عدد مقابض اللعب الحالية.


### هات_رمز_المقبض (getGamepadId)

<div dir=rtl>

```
عرف هات_رمز_المقبض(دليل_المقبض: صـحيح): مؤشر[مصفوفة[مـحرف]]؛
```

</div>

```
function getGamepadId (gpIndex: Int): ptr[array[Char]];
```

دالة تعيد رمز المقبض ذو التسلسل المعطى.


### هات_عدد_محاور_المقبض (getGamepadAxesCount)

<div dir=rtl>

```
عرف هات_عدد_محاور_المقبض(دليل_المقبض: صـحيح): صـحيح؛
```

</div>

```
function getGamepadAxesCount (gpIndex: Int): Int;
```

دالة تعيد عدد محاور المقبض ذو التسلسل المعطى.


### هات_عدد_أزرار_المقبض (getGamepadButtonsCount)

<div dir=rtl>

```
عرف هات_عدد_أزرار_المقبض(دليل_المقبض: صـحيح): صـحيح؛
```

</div>

```
function getGamepadButtonsCount (gpIndex: Int): Int;
```

دالة تعيد عدد أزرار المقبض ذو التسلسل المعطى.


### هات_قيمة_محور_المقبض (getGamepadAxis)

<div dir=rtl>

```
عرف هات_قيمة_محور_المقبض(دليل_المقبض: صـحيح، دليل_المحور: صـحيح): عـائم؛
```

</div>

```
function getGamepadAxis (gpIndex: Int, axisIndex: Int): Float;
```

دالة تعيد قيمة محور المقبض ذو التسلسل المعطى.

المعطيات:

`دليل_المقبض` (`gpIndex`) دليل المقبض.

`دليل_المحور` (`axisIndex`) المحور الذي نريد قيمته.


### هات_قيمة_زر_المقبض (getGamepadButton)

<div dir=rtl>

```
عرف هات_قيمة_زر_المقبض(دليل_المقبض: صـحيح، دليل_الزر: صـحيح): عـائم؛
```

</div>

```
function getGamepadButton (gpIndex: Int, btnIndex: Int): Float;
```

دالة تعيد قيمة زر المقبض ذو التسلسل المعطى.

المعطيات:

`دليل_المقبض` (`gpIndex`) دليل المقبض.

`دليل_الزر` (`btnIndex`) الزر الذي نريد قيمته.


### أعد_التوجيه (httpRedirect)

<div dir=rtl>

```
عرف أعد_التوجيه(عنوان: مؤشر[مـحرف])؛
```

</div>

```
function httpRedirect (address: ptr[Char]);
```

دالة لإعادة توجيه المتصفح إلى عنوان آخر.

المعطيات:

`عنوان` (`address`) العنوان الذي نريد إعادة التوجيه إليه.


### اكتب_في_الطرفية (logToConsole)

<div dir=rtl>

```
عرف اكتب_في_الطرفية(رسالة: مؤشر[مـحرف])؛
```

</div>

```
function logToConsole (msg: ptr[Char]);
```

دالة لطباعة رسالة إلى طرفية المتصفح.


### طابق_نمطا (matchRegex)

<div dir=rtl>

```
عرف طابق_نمطا(نص: مؤشر[مصفوفة[مـحرف]]، نمط: مؤشر[مصفوفة[مـحرف]]، آخر_دليل: سند[صـحيح]): مـصفوفة[نـص]؛
عرف طابق_نمطا(نص: مؤشر[مصفوفة[مـحرف]]، نمط: مؤشر[مصفوفة[مـحرف]]): مـصفوفة[نـص]؛
عرف طابق_نمطا(نص: مؤشر[مصفوفة[مـحرف]]، دليل_نمط: صـحيح_متكيف، آخر_دليل: سند[صـحيح]): مـصفوفة[نـص]؛
عرف طابق_نمطا(نص: مؤشر[مصفوفة[مـحرف]]، نمط: صـحيح_متكيف): مـصفوفة[نـص]؛
```

</div>

```
function matchRegex (str: ptr[array[Char]], regex: ptr[array[Char]], lastIndex: ref[Int]): Array[String];
function matchRegex (str: ptr[array[Char]], regex: ptr[array[Char]]): Array[String];
function matchRegex (str: ptr[array[Char]], regexId: ArchInt, lastIndex: ref[Int]): Array[String];
function matchRegex (str: ptr[array[Char]], regexId: ArchInt): Array[String];
```

دالة للمطابقة بين نص ونمط (regular expression)، ولها 4 نسخ.

معطيات النسخة 1:

* `نص` (`str`) النص المراد مطابقة نمط معه.
* `نمط` (`regex`) النمط المراد مطابقة النص معه.
* `آخر_دليل` (`lastIndex`) يحدد هذا المتغير الدليل الذي يجب البدء منه في عملية المطابقة التالية.


معطيات النسخة 2:

* `نص` (`str`) النص المراد مطابقة نمط معه.
* `نمط` (`regex`) النمط المراد مطابقة النص معه.


معطيات النسخة 3:

* `نص` (`str`) النص المراد مطابقة نمط معه.
* `دليل_نمط` (`regexId`) معرف النمط المراد مطابقة نمط معه.
* `آخر_دليل` (`lastIndex`) يحدد هذا المتغير الدليل الذي يجب البدء منه في عملية المطابقة التالية.


معطيات النسخة 4:

* `نص` (`str`) النص المراد مطابقة نمط معه.
* `دليل_نمط` (`regexId`) معرف النمط المراد مطابقة نمط معه.

